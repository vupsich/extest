from fastapi import FastAPI, HTTPException, Query

app = FastAPI()

# Мини-база данных (список словарей) с добавлением городов
excursions_db = [
    {"id": 1, "name": "Экскурсия по городу", "description": "Прогулка по историческому центру Иркутска", "price": 25.0, "city": "Иркутск"},
    {"id": 2, "name": "Экскурсия в музей", "description": "Посещение краеведческого музея в Ангарске", "price": 15.5, "city": "Ангарск"},
    {"id": 3, "name": "Экскурсия в парк", "description": "Прогулка по природному парку в Братске", "price": 20.0, "city": "Братск"},
    {"id": 4, "name": "Прогулка на Байкал", "description": "Экскурсия на озеро Байкал с гидом", "price": 50.0, "city": "Листвянка"},
    {"id": 5, "name": "Экскурсия на плотину", "description": "Посещение Братской ГЭС", "price": 30.0, "city": "Братск"},
    {"id": 6, "name": "Архитектура Иркутска", "description": "Ознакомление с деревянным зодчеством Иркутска", "price": 40.0, "city": "Иркутск"},
    {"id": 7, "name": "Тур на Тальцы", "description": "Поездка в архитектурно-этнографический музей", "price": 45.0, "city": "Иркутск"},
    
    # Экскурсии в Иркутске
    {"id": 8, "name": "История Иркутска", "description": "Экскурсия по историческим местам города", "price": 30.0, "city": "Иркутск"},
    {"id": 9, "name": "Кулинарный тур", "description": "Дегустация местной кухни", "price": 35.0, "city": "Иркутск"},
    {"id": 10, "name": "Ночной Иркутск", "description": "Прогулка по ночным улицам города", "price": 20.0, "city": "Иркутск"},
    {"id": 11, "name": "Экскурсия на теплоходе", "description": "Прогулка по Ангаре на теплоходе", "price": 40.0, "city": "Иркутск"},
    {"id": 12, "name": "Иркутск и его легенды", "description": "Рассказы о мифах и легендах города", "price": 25.0, "city": "Иркутск"},
    {"id": 13, "name": "Экскурсия по музеям", "description": "Посещение нескольких музеев Иркутска", "price": 50.0, "city": "Иркутск"},
    {"id": 14, "name": "Природа вокруг Иркутска", "description": "Экскурсия по природным достопримечательностям", "price": 45.0, "city": "Иркутск"},
    {"id": 15, "name": "Иркутск в искусстве", "description": "Посещение художественных галерей", "price": 30.0, "city": "Иркутск"},
    {"id": 16, "name": "Экскурсия по старинным домам", "description": "Изучение архитектуры старых зданий", "price": 25.0, "city": "Иркутск"},
    {"id": 17, "name": "Экскурсия по рынкам", "description": "Посещение местных рынков и ярмарок", "price": 20.0, "city": "Иркутск"},
    
    # Экскурсии в Ангарске
    {"id": 18, "name": "Прогулка по Ангарску", "description": "Обзорная экскурсия по городу", "price": 20.0, "city": "Ангарск"},
    {"id": 19, "name": "История Ангарска", "description": "Экскурсия по историческим местам", "price": 25.0, "city": "Ангарск"},
    {"id": 20, "name": "Кулинарный тур по Ангарску", "description": "Дегустация местных блюд", "price": 30.0, "city": "Ангарск"},
    {"id": 21, "name": "Экскурсия в парк культуры", "description": "Прогулка по парку и его достопримечательностям", "price": 15.0, "city": "Ангарск"},
    {"id": 22, "name": "Ангарск и его природа", "description": "Экскурсия по природным местам вокруг города", "price": 20.0, "city": "Ангарск"},
    {"id": 23, "name": "Ночной Ангарск", "description": "Прогулка по ночным улицам города", "price": 18.0, "city": "Ангарск"},
    {"id": 24, "name": "Экскурсия по музеям Ангарска", "description": "Посещение местных музеев", "price": 22.0, "city": "Ангарск"},
    {"id": 25, "name": "История промышленности", "description": "Экскурсия по промышленным объектам", "price": 28.0, "city": "Ангарск"},
    {"id": 26, "name": "Экскурсия на озеро", "description": "Прогулка к ближайшему озеру", "price": 25.0, "city": "Ангарск"},
    {"id": 27, "name": "Экскурсия по старым улицам", "description": "Изучение архитектуры старых зданий", "price": 20.0, "city": "Ангарск"},
    {"id": 28, "name": "Экскурсия на фестиваль", "description": "Посещение местного фестиваля", "price": 15.0, "city": "Ангарск"},
    
    # Экскурсии в Братске
    {"id": 29, "name": "Прогулка по Братску", "description": "Обзорная экскурсия по городу", "price": 20.0, "city": "Братск"},
    {"id": 30, "name": "История Братска", "description": "Экскурсия по историческим местам", "price": 25.0, "city": "Братск"},
    {"id": 31, "name": "Кулинарный тур по Братску", "description": "Дегустация местных блюд", "price": 30.0, "city": "Братск"},
    {"id": 32, "name": "Экскурсия в парк", "description": "Прогулка по парку и его достопримечательностям", "price": 15.0, "city": "Братск"},
    {"id": 33, "name": "Братск и его природа", "description": "Экскурсия по природным местам вокруг города", "price": 20.0, "city": "Братск"},
    {"id": 34, "name": "Ночной Братск", "description": "Прогулка по ночным улицам города", "price": 18.0, "city": "Братск"},
    {"id": 35, "name": "Экскурсия по музеям Братска", "description": "Посещение местных музеев", "price": 22.0, "city": "Братск"},
    {"id": 36, "name": "История промышленности", "description": "Экскурсия по промышленным объектам", "price": 28.0, "city": "Братск"},
    {"id": 37, "name": "Экскурсия на плотину", "description": "Посещение Братской ГЭС", "price": 30.0, "city": "Братск"}]

# 1. Эндпоинт для получения всех экскурсий с возможностью фильтрации по городу через параметры запроса
@app.get("/excursions/")
def get_excursions(city: str = Query(None, description="Название города для фильтрации экскурсий")):
    if city:
        city_excursions = [excursion for excursion in excursions_db if excursion["city"].lower() == city.lower()]
        if not city_excursions:
            raise HTTPException(status_code=404, detail="No excursions found in the specified city")
        return city_excursions
    return excursions_db

# 2. Эндпоинт для получения экскурсии по ID
@app.get("/excursions/{excursion_id}")
def get_excursion(excursion_id: int):
    for excursion in excursions_db:
        if excursion["id"] == excursion_id:
            return excursion
    raise HTTPException(status_code=404, detail="Excursion not found")
